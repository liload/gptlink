import{j as J,r as n,q as se,A as ae,C as U,D as x,G as l,B as m,E as e,F as i,_ as G,an as oe,O as w,a6 as Q,a2 as d,R as j,I as C,aM as p,L as ne,ag as le,aa as ie,W as ce,ak as de,a5 as re,aH as P,ad as ue,a7 as I,a3 as V,ao as pe,am as H,al as xe,X as me,Y as _e,S as ge}from"./index-6941aa4f.js";import{g as ve}from"./index-31c42854.js";import{H as fe}from"./index-d5cb6f45.js";import{N as he}from"./InputGroup-0e435da6.js";const ye={class:"bg-white w-11/12 sm:w-96 pb-6 rounded-lg"},we={class:"text-xl text-[#4f555e] dark:text-white"},be=e("div",{class:"text-lg text-center py-2"}," 充值记录 ",-1),ke={class:"py-2 px-2 w-full"},$e={class:"overflow-x-auto"},Ie={class:"inline-block min-w-full py-2 align-middle"},Ce={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5"},Be={class:"w-full divide-y divide-gray-300"},Se=e("thead",{class:"bg-black"},[e("tr",null,[e("th",{scope:"col",class:"whitespace-nowrap text-center py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-6"}," 名称 "),e("th",{scope:"col",class:"whitespace-nowrap text-center px-3 py-3.5 text-left text-sm font-semibold text-white"}," 问答机会 "),e("th",{scope:"col",class:"whitespace-nowrap text-center px-3 py-3.5 text-left text-sm font-semibold text-white"}," 日期 ")])],-1),Me={class:"divide-y divide-gray-200 bg-white"},Le={class:"py-4 pl-4 pr-3 text-xs text-center font-medium text-gray-900 align-middle"},Re={class:"px-3 py-4 text-xs text-center text-gray-500 align-middle"},Oe={class:"px-3 py-4 text-xs text-center text-gray-500 align-middle"},Ne=J({__name:"Bill",props:{visible:{type:Boolean}},emits:["update:visible"],setup(v,{emit:f}){const _=v,h=n([]),r=se({get(){return _.visible},set(c){f("update:visible",c)}});ae(()=>r.value,()=>{r.value&&b()});const b=async()=>{const c=await p.getUserRecord();h.value=c};return(c,u)=>(m(),U(l(C),{show:r.value,"onUpdate:show":u[1]||(u[1]=o=>r.value=o),"auto-focus":!1},{default:x(()=>[e("div",ye,[i(l(oe),{tooltip:"关闭",class:"absolute top-0 right-0",onClick:u[0]||(u[0]=o=>r.value=!1)},{default:x(()=>[e("span",we,[i(l(G),{icon:"material-symbols:close"})])]),_:1}),be,e("div",ke,[e("div",$e,[e("div",Ie,[e("div",Ce,[e("table",Be,[Se,e("tbody",Me,[(m(!0),w(j,null,Q(h.value,o=>(m(),w("tr",{key:o.id},[e("td",Le,d(o.package_name),1),e("td",Re," +"+d(o.num===-1?`${o.expired_day}天`:`${o.num}次`),1),e("td",Oe,d(o.created_at),1)]))),128))])])])])])])])]),_:1},8,["show"]))}}),B=v=>(me("data-v-2acf09b4"),v=v(),_e(),v),We={class:"bg-white h-page xl:pt-10"},Pe={class:"mx-auto max-w-7xl py-12 pt-2 px-6"},Ue={class:"sm:grid sm:grid-cols-2 sm:gap-6 sm:space-y-0 lg:mx-auto lg:max-w-4xl xl:mx-0 sm:max-w-none xl:max-w-none xl:grid-cols-4 flex flex-wrap justify-between xs:block"},Te={class:"p-4 text-center sm:p-6"},Ee={class:"text-lg font-medium leading-6 text-gray-900 h-12"},Ae={class:"mt-4 sm:mt-8"},Ve={class:"font-bold tracking-tight text-gray-900 text-2xl sm:text-4xl"},He=B(()=>e("span",{class:"text-base font-medium text-gray-500"},"元",-1)),Je={class:"text-sm h-6 text-red-500"},Ge=["href","onClick"],Qe={class:"my-6"},je={class:"px-6 pt-6 pb-8"},qe={class:"text-sm font-medium text-gray-900 flex items-center justify-between"},ze={class:"flex items-center"},De=B(()=>e("ul",{role:"list",class:"mt-6 space-y-4"},[e("li",{class:"flex space-x-3"}," 1.账户充值仅限微信在线支付方式，充值金额实时到账 "),e("li",{class:"flex space-x-3"}," 2.账户有效次数自充值日起至用完为止 ")],-1)),Ke={class:"bg-white w-5/6 xl:w-2/5 sm:w-3/5 pb-6 rounded-lg"},Fe=["innerHTML"],Xe={class:"bg-white w-5/6 xl:w-2/5 sm:w-3/5 pb-6 rounded-lg"},Ye=B(()=>e("div",{class:"mx-auto text-2xl max-w-5xl pt-6 sm:px-6 lg:px-8 text-center"}," 套餐已到账 ",-1)),Ze={class:"text-xl max-w-5xl py-6 sm:px-6 lg:px-8 text-center"},et={class:"text-center"},tt={class:"bg-white w-5/6 sm:w-2/5 pb-20 rounded-lg"},st=B(()=>e("div",{class:"text-2xl max-w-5xl pt-6 sm:px-6 lg:px-8 text-center"}," 微信扫码 ",-1)),at={class:"text-xl max-w-5xl py-6 sm:px-6 lg:4px-8 text-center"},ot=J({__name:"index",setup(v){const f=n(null),_=n(!0),h=n([]),r=n(null),b=ne();le();const c=ie(),{isMobile:u}=ce();let o=null;const y=n(""),S=n(null),k=n(!1),$=n(!1),M=n(null),L=n(!1),R=n({}),O=n(!1),T=()=>/MicroMessenger/i.test(window.navigator.userAgent),q=async()=>{try{const s=await p.getPackageList();h.value=s}catch{}},z=async()=>{try{const s=await p.getPaymentConfig();R.value=s}catch{}},N=()=>{window.history.length>2?b.back():b.replace({name:"Root"})},E=()=>{o&&(o.destroy(),o=null)},A=s=>{if(window.WeixinJSBridge&&s){const{appId:a,timeStamp:t,nonceStr:g,signType:Y,paySign:Z}=s,ee={appId:a,timeStamp:t,nonceStr:g,signType:Y,paySign:Z,package:s.package};window.WeixinJSBridge.invoke("getBrandWCPayRequest",ee,te=>{te.err_msg==="get_brand_wcpay_request:ok"&&(c.success("套餐购买成功",{duration:600}),setTimeout(()=>{N()},1e3)),_.value=!0,E()})}},W=()=>{$.value=!1,clearInterval(f.value),f.value=null},D=async s=>{f.value=setInterval(async()=>{(await p.getOrderStatus({id:s})).status===2&&(W(),c.success("套餐购买成功",{duration:600}),setTimeout(()=>{N()},1e3))},1e3*2)},K=async s=>{if(l(R).channel==="offline"){O.value=!0;return}if(_.value){_.value=!1,o=c.loading("支付中...",{duration:0}),r.value=s;const a=P.get("userKeyOpenId");try{const t=await p.createOrder({package_id:s.id,channel:"wechat",pay_type:T()&&u.value?"JSAPI":"NATIVE",user_id:a||"",platform:1}),g=await p.orderPay({id:t.id});T()&&u.value?typeof window.WeixinJSBridge>"u"?document.addEventListener&&document.addEventListener("WeixinJSBridgeReady",A(g.data)):A(g.data):g.err_code||(M.value=g,$.value=!0,E(),D(t.id))}catch{_.value=!0,o&&(o.destroy(),o=null)}}else setTimeout(()=>{_.value=!0},400)};de(()=>{W()});const F=async()=>{if(!y.value)return c.error("请先输入正确兑换码");try{const s=await p.cdkExchange({cdk:y.value});s.err_code||(S.value=s,k.value=!0)}catch{}},X=()=>{k.value=!1,y.value=""};return re(async()=>{z(),q();const s=ve("code");if(!P.get("userKeyOpenId")&&s)try{const t=await p.getWechatOpenId({code:s,type:ue()&&u.value?"weixin":"weixinweb"});P.set("userKeyOpenId",t.user)}catch{}}),(s,a)=>(m(),w("div",We,[i(l(fe),{"custom-back":N,title:"套餐"}),e("div",Pe,[e("div",Ue,[(m(!0),w(j,null,Q(h.value,t=>(m(),w("div",{key:t.id,class:"divide-y divide-gray-200 rounded-lg border border-gray-200 shadow-sm w-48-100 sm:w-auto mb-4 sm:mb-0"},[e("div",Te,[e("h2",Ee,d(t.name),1),e("p",Ae,[e("span",Ve,d(t.price),1),I(" "+d(" ")+" "),He]),e("div",Je,d(t.identity===2?"开发者专享":""),1),e("a",{href:t.href,class:"mt-2 block w-full rounded-md border border-gray-800 bg-gray-800 py-2 text-center text-sm font-semibold text-white hover:bg-gray-900",onClick:g=>K(t)}," 购买 ",8,Ge)])]))),128))]),e("div",Qe,[i(l(he),null,{default:x(()=>[i(l(pe),{value:y.value,"onUpdate:value":a[0]||(a[0]=t=>y.value=t),style:{width:"100%"},placeholder:"请输入正确的兑换码",size:"large"},null,8,["value"]),i(l(H),{type:"primary",class:"border-gray-800 !bg-gray-800",size:"large",onClick:F},{default:x(()=>[I(" 立即兑换 ")]),_:1})]),_:1})]),e("div",je,[e("h3",qe,[e("div",ze,[i(l(G),{icon:"material-symbols:book-outline-rounded",class:"mr-2"}),I("充值说明 ")]),e("div",{class:"cursor-pointer text-gray-500",onClick:a[1]||(a[1]=t=>L.value=!0)}," 充值记录 > ")]),De])]),i(Ne,{visible:L.value,"onUpdate:visible":a[2]||(a[2]=t=>L.value=t)},null,8,["visible"]),i(l(C),{show:O.value,"onUpdate:show":a[3]||(a[3]=t=>O.value=t),"auto-focus":!1},{default:x(()=>[e("div",Ke,[e("div",{innerHTML:R.value.offline},null,8,Fe)])]),_:1},8,["show"]),S.value?(m(),U(l(C),{key:0,show:k.value,"onUpdate:show":a[4]||(a[4]=t=>k.value=t),"auto-focus":!1},{default:x(()=>[e("div",Xe,[Ye,e("div",Ze,d(S.value.name),1),e("div",et,[i(l(H),{type:"primary",style:{width:"90px"},strong:"",color:"#1f2937",onClick:X},{default:x(()=>[I(" 确定 ")]),_:1})])])]),_:1},8,["show"])):V("",!0),M.value?(m(),U(l(C),{key:1,show:$.value,"onUpdate:show":a[5]||(a[5]=t=>$.value=t),"auto-focus":!1,"on-after-leave":W},{default:x(()=>[e("div",tt,[st,e("div",at," ￥ "+d(r.value.price),1),i(xe,{class:"mx-auto",value:M.value.data.code_url,size:220},null,8,["value"])])]),_:1},8,["show"])):V("",!0)]))}});const dt=ge(ot,[["__scopeId","data-v-2acf09b4"]]);export{dt as default};
