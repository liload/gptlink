import{j as z,r as d,K as O,aN as G,q as _,A as P,B as u,C as S,D as k,E as t,F as c,G as s,_ as q,ao as H,am as A,a7 as L,al as F,O as w,a3 as T,I as J,aJ as Q,J as K,ac as W,X as D,Y as M,af as X,S as R,L as Y,W as Z,M as ee,a5 as te,a2 as g,R as se,a6 as ae,aM as oe,aO as ne,P as j,Q as le}from"./index-6941aa4f.js";import{c as ce}from"./index-31c42854.js";import{N as re}from"./InputGroup-0e435da6.js";import{H as ie}from"./index-d5cb6f45.js";import{T as ue}from"./index-4c07fe1b.js";const V=n=>(D("data-v-ff6ba8ca"),n=n(),M(),n),de={class:"share-body w-full flex flex-col items-center justify-center"},pe={class:"text-xl text-[white]"},fe=V(()=>t("div",{class:"text-base text-[white] text-center mb-2"}," 专属邀请链接 ",-1)),me={class:"flex justify-center"},_e={id:"poster",class:"poster bg-white overflow-hidden"},ve=["src"],he=["src"],xe=V(()=>t("div",{class:"w-3/6 text-sm text-[white] text-center mt-2"}," 保存上方图片，分享你专属海报给朋友 ",-1)),ye=z({__name:"index",props:{visible:{type:Boolean},data:{},type:{}},emits:["update:visible"],setup(n,{emit:$}){const r=n,v=d(""),p=d(""),x=d(null),N=O(),{shareCallback:y}=G(),h=_(()=>{var o;return((o=N.authInfo)==null?void 0:o.user)||{}}),b=_(()=>r.data||{}),i=_({get(){return I(),r.visible},set(o){$("update:visible",o)}}),I=()=>{x.value||Q.getShareInfo({}).then(o=>{x.value=o})},C=_(()=>{const{openid:o}=h.value,{type:l}=s(r);return`${window.location.origin}${l==="distribution"?"/distribution/apply":""}${o?`/?shareOpenId=${o}`:""}`});P(()=>i.value,async()=>{if(i.value){const{openid:o}=h.value,{type:l}=s(r);try{p.value=`${window.location.origin}${l==="/distribution"?"/distribution/apply":""}/${o?`?shareOpenId=${o}`:""}`}catch{}K(()=>{const e=document.querySelector("#poster");W(e,{useCORS:!0,scale:4,backgroundColor:null,ignoreElements:a=>{if(X(a.className)&&a.className.includes("poster-img"))return!0},onclone:a=>{s(r);const f=a.querySelector(".distibution-info");f&&(f.style.transform="translate(-50%, -6.5px)")}}).then(a=>{const f=a.toDataURL();v.value=f}).catch(a=>{console.log(a)})})}});function B(){i.value=!1,y(b.value.type)}function U(){ce({text:p.value,dom:document.querySelector(".share-body")})}return(o,l)=>(u(),S(s(J),{show:i.value,"onUpdate:show":l[1]||(l[1]=e=>i.value=e),"auto-focus":!1},{default:k(()=>[t("div",de,[t("div",{class:"close-btn flex justify-center items-center p-2 cursor-pointer fixed top-0 right-0",onClick:B},[t("span",pe,[c(s(q),{icon:"material-symbols:close",style:{"font-size":"35px"}})])]),fe,t("div",me,[c(s(re),null,{default:k(()=>[c(s(H),{value:p.value,"onUpdate:value":l[0]||(l[0]=e=>p.value=e),class:"flex-1"},null,8,["value"]),c(s(A),{type:"primary",onClick:U},{default:k(()=>[L(" 复制链接 ")]),_:1})]),_:1})]),t("div",_e,[t("img",{src:x.value.share_img,class:"w-full h-full poster-bg"},null,8,ve),c(F,{class:"qrcode",value:C.value,size:50},null,8,["value"]),v.value?(u(),w("img",{key:0,src:v.value,class:"w-full h-full poster-img"},null,8,he)):T("",!0)]),xe])]),_:1},8,["show"]))}}),be=R(ye,[["__scopeId","data-v-ff6ba8ca"]]),ge=n=>(D("data-v-e91ba9fe"),n=n(),M(),n),we={class:"bg-white min-h-screen"},ke={class:"mx-auto w-11/12 sm:w-96"},Ie={class:"pt-8"},Se={class:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 flex items-center"},$e={class:"sm:flex sm:items-end sm:space-x-5 justify-center"},Ne={class:"flex justify-center"},Ce={class:"flex-1 flex items-center userinfo"},Be={class:"flex-1 px-2"},Ue={class:"truncate font-bold text-gray-900"},Ae={class:"mx-4 flex items-center px-4 py-2 sm:px-6 lg:px-8 mt-6 bg-white shadow-2xl rounded-lg",style:{"--tw-shadow":"0 0px 15px -7px rgb(0 0 0 / 0.5)"}},Le={class:"flex items-center flex-1 mr-4 py-2 text-gray-600"},Te={key:0,class:"px-4 sm:px-6 lg:px-8 mt-4"},je=ge(()=>t("div",{class:"font-semibold"}," 任务中心 ",-1)),ze={class:"flex items-center"},Oe={class:"flex-1 text-base italic font-medium truncate"},qe={class:"mt-1 text-xs ml-6 truncate"},De=z({__name:"index",setup(n){const $=Y(),r=O(),{isMobile:v}=Z(),p={invite:{title:"邀请好友",btn:"立即邀请",icon:"ant-design:user-add-outlined"},share:{title:"每日分享",btn:"立即分享",icon:"material-symbols:share"}},x=ee(),N=_(()=>x.webBasicInfo||{}),y=_(()=>{var e;return((e=r.authInfo)==null?void 0:e.user)||{}}),h=d([]),b=d(null),i=d(!1),I=d(null);d("");const C=_(()=>{const e=b.value||{};return Array.isArray(e)?"可用余额不足":e.num===-1?`有效期：${e.expired_at}`:`有效次数：${e.num-e.used}次`}),B=async()=>{const{authInfo:e}=r;if(e)try{const a=await oe.getUserNum();b.value=a}catch{}},U=()=>{$.push({name:"Combo"})},o=async()=>{const e=await ne.getTaskList();h.value=e.filter(a=>a.type!=="register")},l=e=>{i.value=!0,I.value=e};return te(()=>{B(),o(),r.getUserProfile()}),(e,a)=>{var f;return u(),w("div",we,[c(s(ie),{"hide-back":s(v),title:"个人中心"},null,8,["hide-back"]),t("div",ke,[t("div",Ie,[t("div",Se,[t("div",$e,[t("div",Ne,[y.value.avatar?(u(),S(s(j),{key:0,size:"medium",round:"",src:y.value.avatar},null,8,["src"])):(u(),S(s(j),{key:1,size:"medium",round:"",src:((f=N.value)==null?void 0:f.user_logo)||s(le)},null,8,["src"]))])]),t("div",Ce,[t("div",Be,[t("h1",Ue,g(y.value.nickname??""),1)])])])]),t("div",Ae,[t("div",Le,g(b.value?C.value:"可用余额不足"),1),c(s(A),{type:"primary",round:"",onClick:U},{default:k(()=>[L(" 去充值 ")]),_:1})]),h.value.length?(u(),w("div",Te,[je,(u(!0),w(se,null,ae(h.value,(m,E)=>(u(),w("div",{key:E,class:"bg-black rounded-lg shadow text-white py-2 px-3 mt-2"},[t("div",ze,[c(s(q),{icon:p[m.type].icon,class:"mr-1",style:{color:"#fff","font-size":"20px"}},null,8,["icon"]),t("div",Oe,g(m.title),1),c(s(A),{round:"",size:"small",style:{background:"#fff"},onClick:Me=>l(m)},{default:k(()=>[L(g(p[m.type].btn),1)]),_:2},1032,["onClick"])]),t("div",qe,g(m.desc),1)]))),128))])):T("",!0)]),c(s(be),{visible:i.value,"onUpdate:visible":a[0]||(a[0]=m=>i.value=m),data:I.value},null,8,["visible","data"]),s(v)?(u(),S(s(ue),{key:0})):T("",!0)])}}});const He=R(De,[["__scopeId","data-v-e91ba9fe"]]);export{He as default};
